<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us" data-whc_version="24.1">
    <head><link rel="shortcut icon" href="oxygen-webhelp\template\resources/images/favicon.ico"/><link rel="icon" href="oxygen-webhelp\template\resources/images/favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="The G3 MAC Wrapper module is located below the G3 Adaptation layer and on top of both PLC and RF MAC layers. Its mission is to provide abstraction to upper layer (being G3 Adaptation layer or an ..."/><meta name="copyright" content="(C) Copyright 2024"/><meta name="generator" content="DITA-OT"/><title>1.3.2.2 Using the G3 MAC Wrapper Module</title><!--  Generated with Oxygen version 24.1, build number 2022062014.  --><meta name="wh-path2root" content=""/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /D:\InfoShare\Data\Publish\Data\ki41kx2abc0\work\temp?&gt;&lt;?workdir-uri file:/D:/InfoShare/Data/Publish/Data/ki41kx2abc0/work/temp/?&gt;&lt;?path2project?&gt;&lt;?path2project-uri ./?&gt;&lt;?path2rootmap-uri ./?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;using-the-g3-mac-wrapper-module&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;184:15&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/ki41kx2abc0/work/1/en-US/GUID-847B96B1-940C-4A7F-952E-03901A702153.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;184:15&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/ki41kx2abc0/work/1/en-US/GUID-847B96B1-940C-4A7F-952E-03901A702153.md&#34;&gt;Using the G3 MAC Wrapper Module&lt;/title&gt;&lt;titlealts class=&#34;- topic/titlealts &#34;/&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;184:15&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/ki41kx2abc0/work/1/en-US/GUID-847B96B1-940C-4A7F-952E-03901A702153.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;184:15&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/ki41kx2abc0/work/1/en-US/GUID-847B96B1-940C-4A7F-952E-03901A702153.md&#34;&gt;The G3 MAC Wrapper module is located below the G3 Adaptation layer and on top of both PLC and RF MAC layers. Its mission is to provide abstraction to upper layer (being G3 Adaptation layer or an application running on top of G3 MAC), to the fact that we are working on a PLC node, an RF node, or a Hybrid (PLC &amp;amp; RF) node. &lt;fig class=&#34;- topic/fig &#34; xtrc=&#34;fig:1;184:15&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/ki41kx2abc0/work/1/en-US/GUID-847B96B1-940C-4A7F-952E-03901A702153.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;184:15&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/ki41kx2abc0/work/1/en-US/GUID-847B96B1-940C-4A7F-952E-03901A702153.md&#34;&gt;MAC Wrapper Unified Access&lt;/title&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;GUID-2B94AE2F-CE84-4D21-B82D-DFE83E647E6A-low.png&#34; xtrc=&#34;image:1;184:15&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/ki41kx2abc0/work/1/en-US/GUID-847B96B1-940C-4A7F-952E-03901A702153.md&#34; dita-ot:image-width=&#34;711&#34; dita-ot:image-height=&#34;282&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:1;184:15&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/ki41kx2abc0/work/1/en-US/GUID-847B96B1-940C-4A7F-952E-03901A702153.md&#34;&gt;mac_wrapper_unified_access&lt;/alt&gt;&lt;/image&gt;&lt;/fig&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;184:15&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/ki41kx2abc0/work/1/en-US/GUID-847B96B1-940C-4A7F-952E-03901A702153.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;184:15&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/ki41kx2abc0/work/1/en-US/GUID-847B96B1-940C-4A7F-952E-03901A702153.md&#34;&gt;Example application to send data from a G3 node at MAC level, and wait for a response&lt;/b&gt;&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;c&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;184:15&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/ki41kx2abc0/work/1/en-US/GUID-847B96B1-940C-4A7F-952E-03901A702153.md&#34;&gt;#define SRC_PANID 0X1234 #define SRC_ADDRESS 0x0001 #define DEST_PANID 0X1234 #define DEST_ADDRESS 0x0002 SYS_MODULE_OBJ sysObjMacWrp; MAC_WRP_HANDLE g3handle; APP_G3_MAC_DATA appG3Mac; bool txConfirmed; bool frameReceived; uint8_t txHandle; uint8_t txBuffer[MAC_MAX_PAYLOAD_SIZE]; uint16_t txLength; static void APP_SendData(uint8_t* pData, uint16_t length) { MAC_WRP_DATA_REQUEST_PARAMS drParams; if (length &amp;gt; MAC_MAX_PAYLOAD_SIZE) { return; } /* Prepare Data Request parameters */ drParams.srcAddressMode = MAC_WRP_ADDRESS_MODE_SHORT; drParams.destPanId = DEST_PANID; drParams.destAddress = DEST_ADDRESS; drParams.msduLength = length; drParams.msdu = pData; drParams.msduHandle = txHandle++; drParams.txOptions = 1; drParams.securityLevel = MAC_WRP_SECURITY_LEVEL_ENC_MIC_32; drParams.keyIndex = 0; drParams.qualityOfService = MAC_WRP_QUALITY_OF_SERVICE_NORMAL_PRIORITY; drParams.mediaType = MAC_WRP_MEDIA_TYPE_REQ_PLC_BACKUP_RF; /* Send MAC Frame */ txConfirmed = false; MAC_WRP_DataRequest(g3handle, &amp;amp;drParams); } static void APP_G3_MAC_DATACfmCb(MAC_WRP_DATA_CONFIRM_PARAMS *cfmObj) { /* Update flag */ txConfirmed = true; } static void APP_G3_MAC_DATAIndCb(MAC_WRP_DATA_INDICATION_PARAMS *indObj) { /* Do whatever with received frame */ frameReceived = true; } void APP_G3_MAC_Initialize(void) { /* Call system-like Initialize function */ sysObjMacWrp = MAC_WRP_Initialize(MAC_WRP_INDEX_0); /* Set App state */ appG3Mac.state = APP_G3_MAC_STATE_IDLE; } void APP_G3_MAC_OpenAndInit(void) { /* Configure callbacks */ MAC_WRP_HANDLERS macWrpHandlers = { .dataConfirmCallback = APP_G3_MAC_DATACfmCb, .dataIndicationCallback = APP_G3_MAC_DATAIndCb, .resetConfirmCallback = NULL, // Reset primitive not used .beaconNotifyIndicationCallback = NULL, // BCN notify primitive not used .scanConfirmCallback = NULL, // Scan primitive not used .startConfirmCallback = NULL, // Start primitive not used .commStatusIndicationCallback = NULL, // CommStatus primitive not used .snifferIndicationCallback = NULL, // MAC Sniffer not used }; /* Open an instance of module */ g3handle = MAC_WRP_Open(MAC_WRP_INDEX_0, MAC_WRP_BAND_CENELEC_A); /* Set callbacks */ MAC_WRP_SetCallbacks(g3handle, &amp;amp;macWrpHandlers); } void APP_G3_MAC_Tasks(void) { /* Check the application's current state. */ switch (appG3Mac.state) { case APP_STATE_IDLE: { /* Go to next state */ appG3Mac.state = APP_G3_MAC_STATE_OPEN_AND_INIT; } break; case APP_G3_MAC_STATE_OPEN_AND_INIT: { /* Open and Init a MAC Wrapper instance */ APP_G3_MAC_OpenAndInit(); appG3Mac.state = APP_G3_MAC_STATE_SET_PARAMS; } break; case APP_G3_MAC_STATE_SET_PARAMS: { /* Set own Address and PAN_ID */ MAC_WRP_STATUS status; MAC_WRP_PIB_VALUE pibVal; uint16_t panId = SRC_PANID; uint16_t address = SRC_ADDRESS; pibVal.length = 2; memcpy(pibVal.value, &amp;amp;panId, sizeof(panId)); status = MAC_WRP_SetRequestSync(g3handle, MAC_WRP_PIB_PAN_ID, 0, &amp;amp;pibVal); if (status == MAC_WRP_STATUS_SUCCESS) { memcpy(pibVal.value, &amp;amp;address, sizeof(address)); status = MAC_WRP_SetRequestSync(g3handle, MAC_WRP_PIB_SHORT_ADDRESS, 0, &amp;amp;pibVal); if (status == MAC_WRP_STATUS_SUCCESS) { /* Go to next state */ appG3Mac.state = APP_G3_MAC_STATE_TX_REQUEST; } } break; } case APP_G3_MAC_STATE_TX_REQUEST: { /* Build a frame in buffer and set length before calling SendData */ APP_SendData(txBuffer, txLength); appG3Mac.state = APP_G3_MAC_STATE_WAITING_TX_CFM; break; } case APP_G3_MAC_STATE_WAITING_TX_CFM: { if (txConfirmed) { frameReceived = false; appG3Mac.state = APP_G3_MAC_STATE_WAITING; } break; } case APP_G3_MAC_STATE_WAITING: { if (frameReceived) { frameReceived = false; /* Send another frame */ appG3Mac.state = APP_G3_MAC_STATE_TX_REQUEST; } break; } /* The default state should never be executed. */ default: { /* Handle error in application's state machine. */ break; } } } &lt;/codeblock&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; mapkeyref=&#34;GUID-F459904F-E8A0-4ADE-858D-BEDA7E2E4B53&#34; xtrc=&#34;topicref:5;6:981&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/ki41kx2abc0/work/1/en-US/GUID-5533695B-B7B3-4E22-8CAE-B556E34F0200.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;GUID-8E538DB4-AC18-45BC-8284-8A2E0B1C6E4A.md&#34; mapclass=&#34;- map/topicref &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:3;6:535&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/ki41kx2abc0/work/1/en-US/GUID-5533695B-B7B3-4E22-8CAE-B556E34F0200.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot gentext?&gt;G3 MAC Wrapper Module&lt;/linktext&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="GUID-847B96B1-940C-4A7F-952E-03901A702153.md"/><meta name="wh-out-relpath" content="GUID-847B96B1-940C-4A7F-952E-03901A702153.html"/>
    <!-- Latest compiled and minified Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" href="./oxygen-webhelp/lib/bootstrap/css/bootstrap.min.css"/>
    
    <link rel="stylesheet" href="./oxygen-webhelp/lib/jquery-ui/jquery-ui.min.css"/>
    
    <!-- Template default styles  -->
    <link rel="stylesheet" type="text/css" href="./oxygen-webhelp/app/topic-page.css?buildId=2022062014"/>
    
    
    <script src="./oxygen-webhelp/lib/jquery/jquery-3.5.1.min.js"></script>
    
    <script data-main="./oxygen-webhelp/app/topic-page.js" src="./oxygen-webhelp/lib/requirejs/require.js"></script>
<link rel="stylesheet" type="text/css" href="oxygen-webhelp/template/microchip.css?buildId=2022062014"/><link rel="stylesheet" type="text/css" href="oxygen-webhelp/template/notes.css?buildId=2022062014"/>
<script src="mchp-context-help.js"></script>
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300" rel="stylesheet" type="text/css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async="" type="text/javascript"></script>
    <script src="https://assets.adobedtm.com/6a72a357eb48/a636c708c7fe/launch-0b0023397020.min.js"></script><!-- Adobe Analytics -->
</head>

    <body id="using-the-g3-mac-wrapper-module" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            Jump to main content
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="index.html" class=" wh_logo d-none d-sm-block "><img src="oxygen-webhelp\template\resources/images/microchip.png" alt="MPLAB® Harmony Smart Energy G3 Stack &#xA;    "/></a>
                    <div class=" wh_publication_title "><a href="index.html">MPLAB® Harmony Smart Energy G3 Stack 
    </a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        </div>
    </div>
</header>
        
        
         
        
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="search.html"><div class="d-flex justify-contents-around"><div class="flex-grow-1"></div><div class="position-relative flex-grow-1"><input type="search" placeholder="Search " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="Search query" required="required"/><button type="submit" class="wh_search_button" aria-label="Search"><span class="search_input_text">Search</span></button></div><div class="align-self-center flex-grow-1 ml-2"></div></div></form>
            
            <div class="mchp-color-stripe-grid-container">
  <div class="mchp-main-bar mchp-orange-bar"></div>
  <div class="mchp-main-bar mchp-blue-bar"></div>
  <div class="mchp-main-bar mchp-green-bar"></div>
</div>
            
        </div>
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="index.html"><span>Home</span></a></span></li><li><div class="topicref" data-id="mplab-harmony-smart-energy-g3-stack"><div class="title"><a href="GUID-8D7FF9CF-C7F4-4C84-9650-F7C196FA7CCE.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1</ph>
MPLAB® Harmony Smart Energy G3 Stack</a></div></div></li><li><div class="topicref" data-id="g3-mac-layer"><div class="title"><a href="GUID-3CD2B9A8-5FE2-444E-8C9C-4B44B1793511.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.3</ph>
G3 MAC Layer</a></div></div></li><li><div class="topicref" data-id="g3-mac-wrapper-module"><div class="title"><a href="GUID-8E538DB4-AC18-45BC-8284-8A2E0B1C6E4A.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.3.2</ph>
G3 MAC Wrapper Module</a></div></div></li><li class="active"><div class="topicref" data-id="using-the-g3-mac-wrapper-module"><div class="title"><a href="GUID-847B96B1-940C-4A7F-952E-03901A702153.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.3.2.2</ph>
Using the G3 MAC Wrapper Module</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="Toggle search highlights" title="Toggle search highlights"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="Collapse sections" title="Collapse sections"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            <div class="row" style="margin-top: -1em;"><div class="col-lg-9 col-md-9 col-sm-12 offset-lg-3 offset-md-3 text-right border-bottom mb-1"><h2 class="text-dark header_title">
    </h2></div></div>
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem" aria-expanded="true"><div data-tocid="mplab-harmony-smart-energy-g3-stack-d2680e11" class="topicref" data-id="mplab-harmony-smart-energy-g3-stack" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action mplab-harmony-smart-energy-g3-stack-d2680e11-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-8D7FF9CF-C7F4-4C84-9650-F7C196FA7CCE.html" id="mplab-harmony-smart-energy-g3-stack-d2680e11-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1</ph>
MPLAB® Harmony Smart Energy G3 Stack</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="configuring-the-g3-stack-d2680e19" class="topicref" data-id="configuring-the-g3-stack" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-9F252FF0-1A85-4731-A3CB-F90DB068F6AD.html" id="configuring-the-g3-stack-d2680e19-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.1</ph>
Configuring The G3 Stack</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="g3-adaptation-layer-d2680e27" class="topicref" data-id="g3-adaptation-layer" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action g3-adaptation-layer-d2680e27-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-0BC0892E-8FC3-4B43-8243-1C16A6766E31.html" id="g3-adaptation-layer-d2680e27-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.2</ph>
G3 Adaptation Layer</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="g3-mac-layer-d2680e876" class="topicref" data-id="g3-mac-layer" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action g3-mac-layer-d2680e876-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-3CD2B9A8-5FE2-444E-8C9C-4B44B1793511.html" id="g3-mac-layer-d2680e876-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.3</ph>
G3 MAC Layer</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="configuring-the-g3-mac-layer-d2680e884" class="topicref" data-id="configuring-the-g3-mac-layer" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-944A8723-E7E1-4616-B8B5-803E493EC106.html" id="configuring-the-g3-mac-layer-d2680e884-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.3.1</ph>
Configuring The G3 MAC Layer</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="g3-mac-wrapper-module-d2680e892" class="topicref" data-id="g3-mac-wrapper-module" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action g3-mac-wrapper-module-d2680e892-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-8E538DB4-AC18-45BC-8284-8A2E0B1C6E4A.html" id="g3-mac-wrapper-module-d2680e892-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.3.2</ph>
G3 MAC Wrapper Module</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="how-the-g3-mac-wrapper-module-works-d2680e900" class="topicref" data-id="how-the-g3-mac-wrapper-module-works" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-8031F51F-4BAA-451C-99BA-D4A7F7A71DA8.html" id="how-the-g3-mac-wrapper-module-works-d2680e900-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.3.2.1</ph>
How the G3 MAC Wrapper module works</a></div></div></li><li role="treeitem" class="active"><div data-tocid="using-the-g3-mac-wrapper-module-d2680e908" class="topicref" data-id="using-the-g3-mac-wrapper-module" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-847B96B1-940C-4A7F-952E-03901A702153.html" id="using-the-g3-mac-wrapper-module-d2680e908-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.3.2.2</ph>
Using the G3 MAC Wrapper Module</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="g3-mac-wrapper-module-interface-d2680e916" class="topicref" data-id="g3-mac-wrapper-module-interface" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action g3-mac-wrapper-module-interface-d2680e916-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-4491B48C-42B5-463D-9893-D8A2C4D4A62C.html" id="g3-mac-wrapper-module-interface-d2680e916-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.3.2.3</ph>
G3 MAC Wrapper Module Interface</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="g3-mac-common-module-d2680e1522" class="topicref" data-id="g3-mac-common-module" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action g3-mac-common-module-d2680e1522-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-C00E71E6-496B-4ACE-98CA-BCD06356C4B5.html" id="g3-mac-common-module-d2680e1522-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.3.3</ph>
G3 MAC Common Module</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="g3-mac-plc-module-d2680e1910" class="topicref" data-id="g3-mac-plc-module" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action g3-mac-plc-module-d2680e1910-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-BFF1042D-25D0-4BE5-9473-0E2467A00B56.html" id="g3-mac-plc-module-d2680e1910-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.3.4</ph>
G3 MAC PLC Module</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="g3-mac-rf-module-d2680e2112" class="topicref" data-id="g3-mac-rf-module" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action g3-mac-rf-module-d2680e2112-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-FA8AE9BB-E07D-4587-B951-D3AF01D16D6C.html" id="g3-mac-rf-module-d2680e2112-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.3.5</ph>
G3 MAC RF Module</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="g3-plc-pal-module-d2680e2322" class="topicref" data-id="g3-plc-pal-module" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action g3-plc-pal-module-d2680e2322-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-E9ACB7E5-5632-4FD1-89C5-8D0832C624BC.html" id="g3-plc-pal-module-d2680e2322-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.4</ph>
G3 PLC PAL Module</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="g3-rf-pal-module-d2680e2523" class="topicref" data-id="g3-rf-pal-module" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action g3-rf-pal-module-d2680e2523-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-07E98617-C9A0-45DB-A4FC-9A4251FCD754.html" id="g3-rf-pal-module-d2680e2523-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.5</ph>
G3 RF PAL Module</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="g3-adp-mac-driver-module-d2680e2781" class="topicref" data-id="g3-adp-mac-driver-module" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action g3-adp-mac-driver-module-d2680e2781-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-29AB9B5D-DC8B-4CEC-910B-3D313AFA91F6.html" id="g3-adp-mac-driver-module-d2680e2781-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.6</ph>
G3 ADP MAC Driver Module</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="getting-started-with-mplab-harmony-g3-stack-d2680e2966" class="topicref" data-id="getting-started-with-mplab-harmony-g3-stack" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action getting-started-with-mplab-harmony-g3-stack-d2680e2966-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-CDCB92D5-6846-41EB-BB39-40A46235EB7D.html" id="getting-started-with-mplab-harmony-g3-stack-d2680e2966-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">2</ph>
Getting Started with MPLAB® Harmony G3 Stack</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B-d2680e3079" class="topicref backmatter backmatter_parent" data-id="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B-d2680e3079-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B.html" id="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B-d2680e3079-link">Microchip Information</a></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-9 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        
                        <div class=" wh_topic_content body "><main role="main"><article role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1" style="">1.3.2.2 Using the G3 MAC Wrapper Module</h1><div class="- topic/body body"><div class="- topic/p p">The G3 MAC Wrapper module is located below the G3 Adaptation layer and on top of both PLC and RF MAC layers.
Its mission is to provide abstraction to upper layer (being G3 Adaptation layer or an application running on top of G3 MAC), to the fact that we are working on a PLC node, an RF node, or a Hybrid (PLC &amp; RF) node.
<figure class="- topic/fig fig fignone"><figcaption class="- topic/title title figcap"><span class="figtitleprefix fig--title-label">Figure . <span class="fig--title">MAC Wrapper Unified Access</span></span></figcaption><div class=""><img class="- topic/image image" src="GUID-2B94AE2F-CE84-4D21-B82D-DFE83E647E6A-low.png" alt="mac_wrapper_unified_access"/></div></figure></div><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">Example application to send data from a G3 node at MAC level, and wait for a response</strong></p><pre class="+ topic/pre pr-d/codeblock pre codeblock c"><span class="hl-directive">#define</span> <span class="hl-defines">SRC_PANID</span>      <span class="hl-number">0X1234</span>
<span class="hl-directive">#define</span> <span class="hl-defines">SRC_ADDRESS</span>    <span class="hl-number">0x0001</span>
<span class="hl-directive">#define</span> <span class="hl-defines">DEST_PANID</span>     <span class="hl-number">0X1234</span>
<span class="hl-directive">#define</span> <span class="hl-defines">DEST_ADDRESS</span>   <span class="hl-number">0x0002</span>

SYS_MODULE_OBJ sysObjMacWrp;
MAC_WRP_HANDLE g3handle;
APP_G3_MAC_DATA appG3Mac;
bool txConfirmed;
bool frameReceived;
uint8_t txHandle;
uint8_t txBuffer[MAC_MAX_PAYLOAD_SIZE];
uint16_t txLength;

<strong class="hl-keyword">static</strong> <strong class="hl-keyword">void</strong> <span class="hl-functions">APP_SendData</span>(uint8_t* pData, uint16_t length)
{
    MAC_WRP_DATA_REQUEST_PARAMS drParams;

    <strong class="hl-keyword">if</strong> (length &gt; MAC_MAX_PAYLOAD_SIZE) {
        <strong class="hl-keyword">return</strong>;
    }

    <em class="hl-comment">/* Prepare Data Request parameters */</em>
    drParams.srcAddressMode = MAC_WRP_ADDRESS_MODE_SHORT;
    drParams.destPanId = DEST_PANID;
    drParams.destAddress = DEST_ADDRESS;
    drParams.msduLength = length;
    drParams.msdu = pData;
    drParams.msduHandle = txHandle++;
    drParams.txOptions = <span class="hl-number">1</span>;
    drParams.securityLevel = MAC_WRP_SECURITY_LEVEL_ENC_MIC_<span class="hl-number">32</span>;
    drParams.keyIndex = <span class="hl-number">0</span>;
    drParams.qualityOfService = MAC_WRP_QUALITY_OF_SERVICE_NORMAL_PRIORITY;
    drParams.mediaType = MAC_WRP_MEDIA_TYPE_REQ_PLC_BACKUP_RF;

    <em class="hl-comment">/* Send MAC Frame */</em>
    txConfirmed = false;
    MAC_WRP_DataRequest(g3handle, &amp;drParams);
}

<strong class="hl-keyword">static</strong> <strong class="hl-keyword">void</strong> <span class="hl-functions">APP_G3_MAC_DATACfmCb</span>(MAC_WRP_DATA_CONFIRM_PARAMS *cfmObj)
{
    <em class="hl-comment">/* Update flag */</em>
    txConfirmed = true;
}

<strong class="hl-keyword">static</strong> <strong class="hl-keyword">void</strong> <span class="hl-functions">APP_G3_MAC_DATAIndCb</span>(MAC_WRP_DATA_INDICATION_PARAMS *indObj)
{
    <em class="hl-comment">/* Do whatever with received frame */</em>
    frameReceived = true;
}

<strong class="hl-keyword">void</strong> <span class="hl-functions">APP_G3_MAC_Initialize</span>(<strong class="hl-keyword">void</strong>)
{
    <em class="hl-comment">/* Call system-like Initialize function */</em>
    sysObjMacWrp = MAC_WRP_Initialize(MAC_WRP_INDEX_<span class="hl-number">0</span>);

    <em class="hl-comment">/* Set App state */</em>
    appG3Mac.state = APP_G3_MAC_STATE_IDLE;
}

<strong class="hl-keyword">void</strong> <span class="hl-functions">APP_G3_MAC_OpenAndInit</span>(<strong class="hl-keyword">void</strong>)
{
    <em class="hl-comment">/* Configure callbacks */</em>
    MAC_WRP_HANDLERS macWrpHandlers = {
        .dataConfirmCallback = APP_G3_MAC_DATACfmCb,
        .dataIndicationCallback = APP_G3_MAC_DATAIndCb,
        .resetConfirmCallback = NULL, <em class="hl-comment">// Reset primitive not used</em>
        .beaconNotifyIndicationCallback = NULL, <em class="hl-comment">// BCN notify primitive not used</em>
        .scanConfirmCallback = NULL, <em class="hl-comment">// Scan primitive not used</em>
        .startConfirmCallback = NULL, <em class="hl-comment">// Start primitive not used</em>
        .commStatusIndicationCallback = NULL, <em class="hl-comment">// CommStatus primitive not used</em>
        .snifferIndicationCallback = NULL, <em class="hl-comment">// MAC Sniffer not used</em>
    };

    <em class="hl-comment">/* Open an instance of module */</em>
    g3handle = MAC_WRP_Open(MAC_WRP_INDEX_<span class="hl-number">0</span>, MAC_WRP_BAND_CENELEC_A);
    <em class="hl-comment">/* Set callbacks */</em>
    MAC_WRP_SetCallbacks(g3handle, &amp;macWrpHandlers);
}

<strong class="hl-keyword">void</strong> <span class="hl-functions">APP_G3_MAC_Tasks</span>(<strong class="hl-keyword">void</strong>)
{
    <em class="hl-comment">/* Check the application's current state. */</em>
    <strong class="hl-keyword">switch</strong> (appG3Mac.state)
    {
        <strong class="hl-keyword">case</strong> APP_STATE_IDLE:
        {
            <em class="hl-comment">/* Go to next state */</em>
            appG3Mac.state = APP_G3_MAC_STATE_OPEN_AND_INIT;
        }
        <strong class="hl-keyword">break</strong>;

        <strong class="hl-keyword">case</strong> APP_G3_MAC_STATE_OPEN_AND_INIT:
        {
            <em class="hl-comment">/* Open and Init a MAC Wrapper instance */</em>
            APP_G3_MAC_OpenAndInit();
            appG3Mac.state = APP_G3_MAC_STATE_SET_PARAMS;
        }
        <strong class="hl-keyword">break</strong>;

        <strong class="hl-keyword">case</strong> APP_G3_MAC_STATE_SET_PARAMS:
        {
            <em class="hl-comment">/* Set own Address and PAN_ID */</em>
            MAC_WRP_STATUS status;
            MAC_WRP_PIB_VALUE pibVal;
            uint16_t panId = SRC_PANID;
            uint16_t address = SRC_ADDRESS;

            pibVal.length = <span class="hl-number">2</span>;
            memcpy(pibVal.value, &amp;panId, <strong class="hl-keyword">sizeof</strong>(panId));
            status = MAC_WRP_SetRequestSync(g3handle, MAC_WRP_PIB_PAN_ID, <span class="hl-number">0</span>, &amp;pibVal);
            <strong class="hl-keyword">if</strong> (status == MAC_WRP_STATUS_SUCCESS)
            {
                memcpy(pibVal.value, &amp;address, <strong class="hl-keyword">sizeof</strong>(address));
                status = MAC_WRP_SetRequestSync(g3handle, MAC_WRP_PIB_SHORT_ADDRESS, <span class="hl-number">0</span>, &amp;pibVal);
                <strong class="hl-keyword">if</strong> (status == MAC_WRP_STATUS_SUCCESS)
                {
                    <em class="hl-comment">/* Go to next state */</em>
                    appG3Mac.state = APP_G3_MAC_STATE_TX_REQUEST;
                }
            }
            <strong class="hl-keyword">break</strong>;
        }

        <strong class="hl-keyword">case</strong> APP_G3_MAC_STATE_TX_REQUEST:
        {
            <em class="hl-comment">/* Build a frame in buffer and set length before calling SendData */</em>
            APP_SendData(txBuffer, txLength);
            appG3Mac.state = APP_G3_MAC_STATE_WAITING_TX_CFM;
            <strong class="hl-keyword">break</strong>;
        }

        <strong class="hl-keyword">case</strong> APP_G3_MAC_STATE_WAITING_TX_CFM:
        {
            <strong class="hl-keyword">if</strong> (txConfirmed)
            {
                frameReceived = false;
                appG3Mac.state = APP_G3_MAC_STATE_WAITING;
            }
            <strong class="hl-keyword">break</strong>;
        }

        <strong class="hl-keyword">case</strong> APP_G3_MAC_STATE_WAITING:
        {
            <strong class="hl-keyword">if</strong> (frameReceived)
            {
                frameReceived = false;
                <em class="hl-comment">/* Send another frame */</em>
                appG3Mac.state = APP_G3_MAC_STATE_TX_REQUEST;
            }
            <strong class="hl-keyword">break</strong>;
        }

        <em class="hl-comment">/* The default state should never be executed. */</em>
        <strong class="hl-keyword">default</strong>:
        {
            <em class="hl-comment">/* Handle error in application's state machine. */</em>
            <strong class="hl-keyword">break</strong>;
        }
    }
}
</pre></div></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
    <div class="footer">
  <div class="mchp-wh-footer">
    <div class="mchp-footer">
      <div class="mchp-footer-tier1">
        <div class="spacer"></div>
        <div class="mchp-footer-container">
          <div class="mchp-footer-links mchp-social-media-links">
            <div class="mchp-component-items">
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.facebook.com/pages/Microchip-Technology-Inc/20320981741" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Facebook" src="oxygen-webhelp/template/resources/images/201016-corp-facebook.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.linkedin.com/company/microchip-technology" target="_blank">
                  <img class="cmp-image__image" alt="Microchip LinkedIn" src="oxygen-webhelp/template/resources/images/201016-corp-linkedin.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://twitter.com/MicrochipTech" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Twitter" src="oxygen-webhelp/template/resources/images/201016-corp-twitter.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.youtube.com/user/MicrochipTechnology" target="_blank">
                  <img class="cmp-image__image" alt="Microchip YouTube" src="oxygen-webhelp/template/resources/images/201016-corp-youtube.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.instagram.com/microchiptechnologyinc/" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Instagram" src="oxygen-webhelp/template/resources/images/201016-corp-instagram.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.weibo.com/microchiptech" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Weibo" src="oxygen-webhelp/template/resources/images/201016-corp-weibo.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.microchip.com/en-us/about/blog" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Blog" src="oxygen-webhelp/template/resources/images/201016-corp-blog.png"/>
                </a>
              </div>
            </div>
          </div>
          <div class="mchp-footer-links">
            <div class="mchp-component-items">
              <div class="mchp-component-item">
                <div class="link">
                  <a href="https://www.microchip.com/about-us/contact-us" class="mchp-link__link">Contact</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item ">
                <div class="link">
                  <a href="https://www.microchip.com/en-us/about/legal-information" class="mchp-link__link">Legal</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item ">
                <div class="link">
                  <a href="https://www.microchip.com/en-us/about/legal-information/privacy-policy" class="mchp-link__link">Privacy Policy</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item ">
                <div class="link">
                  <a href="https://www.microchip.com/en-us/about/legal-information/microchip-cookie-statement" class="mchp-link__link">Cookies</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item">
                <div class="link">
                  <a href="https://careers.microchip.com/" class="mchp-link__link">Careers</a>
                  <span class="mchp-link__separator"></span>
                </div>
              </div>
            </div>
          </div>
          <div class="mchp-footer-newsletter">
            <div class="cmp-text">
              <p>Stay on the leading edge with our blog</p>
            </div>
            <div class="mchp-button-wrapper">
              <a role="button" href="https://www.microchip.com/en-us/about/blog" class="mchp-button mchp-button-regular solid">
                <span class="mchp-button__span">MicroSolutions</span>
              </a>
            </div>
          </div>
        </div>
        <div class="graphic">
          <img src="oxygen-webhelp/template/resources/images/footer-graphic.png"/>
        </div>
      </div>
      <div class="mchp-footer-tier2">
        <p class="mchp-copyright">© Copyright 1998-2022 Microchip Technology Inc. All rights reserved.</p>
      </div>
    </div>
  </div>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="true" src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-19"></script>
  <script>
    window.dataLayer = window.dataLayer || [];  
    function gtag(){dataLayer.push(arguments);}  
    gtag('js', new Date());   
    gtag('config', 'UA-2724382-19');
  </script>
  
  <script type="text/javascript">_satellite.pageBottom();</script><!-- Adobe Analytics -->
  <script type="text/javascript" src="mchp-js/prepend.js"></script><!-- Package for viewing PDFs on mobile devices -->
  
</div>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
       
        </body>
</html>